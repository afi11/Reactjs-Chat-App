{"ast":null,"code":"var _jsxFileName = \"D:\\\\CODE\\\\code\\\\ReactJS\\\\chatapp\\\\src\\\\pages\\\\chatroom\\\\index.jsx\";\nimport React, { useEffect, useState } from \"react\";\nimport axios from \"axios\";\nimport Moment from \"react-moment\";\nimport { useParams } from \"react-router-dom\";\nimport { ReactMic } from \"react-mic\";\nimport { urlApiMain, urlWeb } from \"../../utils/url\";\nimport { Auth } from \"../../config\";\n\nconst ChatRoom = () => {\n  const {\n    id\n  } = useParams();\n  const [recordAudio, setRecordAudio] = useState(false);\n  const [messages, setMessages] = useState([]);\n  const [sendmessage, setSetmessage] = useState({\n    messages: \"\",\n    image: \"\",\n    audio: \"\",\n    receiver: id\n  });\n\n  const onDataAudio = recordedBlob => {};\n\n  const onStopAudio = recordedBlob => {\n    console.log(\"recordedBlob is: \", recordedBlob.blob);\n    var fileReader = new FileReader();\n    fileReader.readAsDataURL(recordedBlob.blob);\n\n    fileReader.onload = e => {\n      setSetmessage({ ...sendmessage,\n        [\"audio\"]: e.target.result\n      });\n      sendMessage();\n    };\n  };\n\n  const getChat = () => {\n    axios.get(`${urlApiMain}getchat/${id}`).then(res => {\n      setMessages(res.data);\n    }).catch(err => {});\n  };\n\n  const onChangeInput = event => {\n    const {\n      name,\n      value\n    } = event.target;\n    setSetmessage({ ...sendmessage,\n      [name]: value\n    });\n  };\n\n  const getFile = () => {\n    document.getElementById(\"fileImage\").click();\n  };\n\n  const getFileMessage = event => {\n    var fileReader = new FileReader();\n    fileReader.readAsDataURL(event.target.files[0]);\n    const {\n      type\n    } = event.target.files[0];\n    console.log(event.target.files[0]);\n\n    if (type == \"image/png\" || type == \"image/jpeg\") {\n      fileReader.onload = e => {\n        setSetmessage({ ...sendmessage,\n          [\"image\"]: e.target.result\n        });\n      };\n    } else {\n      alert(\"Image must has extention is png or jpeg.\");\n    }\n  };\n\n  const clearChat = () => {\n    setSetmessage({ ...sendmessage,\n      [\"messages\"]: \"\",\n      [\"image\"]: \"\"\n    });\n  };\n\n  const clearImage = () => {\n    setSetmessage({ ...sendmessage,\n      [\"image\"]: \"\"\n    });\n  };\n\n  const readMessage = () => {\n    axios.get(`${urlApiMain}readmessage/${id}`).then(res => {}).then(err => {\n      console.log(err);\n    });\n  };\n\n  const sendMessage = () => {\n    axios.post(urlApiMain + \"sendchat\", sendmessage).then(res => {\n      console.log(res);\n      getChat();\n      clearChat();\n    }).catch(err => {\n      console.log(err);\n    });\n  }; // set permission audio\n\n\n  useEffect(() => {// navigator.getUserMedia(\n    //   { audio: true },\n    //   () => {\n    //     console.log(\"Permission Granted\");\n    //     setIsBlocked(false);\n    //   },\n    //   () => {\n    //     console.log(\"Permission Denied\");\n    //     setIsBlocked(true);\n    //   }\n    // );\n  }, []);\n  useEffect(() => {\n    const interval = setInterval(() => {\n      readMessage();\n    }, 10000);\n    return () => clearInterval(interval);\n  }, []);\n  useEffect(() => {\n    const interval = setInterval(() => {\n      getChat();\n    }, 1000);\n    return () => clearInterval(interval);\n  }, []);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"flex justify-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"bg-white md:w-1/2 mt-4 mb-6 rounded shadow-lg\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"px-6 py-6\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    className: \"font-semibold\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 11\n    }\n  }, \" \", /*#__PURE__*/React.createElement(\"i\", {\n    class: \"fas fa-arrow-left\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 13\n    }\n  }), \" Chat With By User\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"bg-gray-200 message-height px-3 py-2 overflow-auto\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 11\n    }\n  }, messages.map(message => message.sender == Auth.getTokenAndUserId().userid ? /*#__PURE__*/React.createElement(\"div\", {\n    className: \"flex flex-col items-end mb-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"w-1/2 px-3 py-2 right-0 rounded-tl-lg rounded-br-lg bg-green-300\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 19\n    }\n  }, message.image === null ? /*#__PURE__*/React.createElement(React.Fragment, null) : /*#__PURE__*/React.createElement(\"img\", {\n    src: urlWeb + \"messages/\" + message.image,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 23\n    }\n  }), /*#__PURE__*/React.createElement(\"p\", {\n    className: \"text-gray-800\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 21\n    }\n  }, message.messages), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"flex flex-row w-full\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    className: \"text-gray-700 font-bold text-sm\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 23\n    }\n  }, /*#__PURE__*/React.createElement(Moment, {\n    fromNow: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 25\n    }\n  }, message.created_at)), message.is_read == \"1\" ? /*#__PURE__*/React.createElement(\"i\", {\n    class: \"fas fa-check mt-1 ml-2 text-blue-500\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 25\n    }\n  }) : /*#__PURE__*/React.createElement(\"i\", {\n    class: \"fas fa-check mt-1 ml-2 text-gray-500\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 25\n    }\n  })))) : /*#__PURE__*/React.createElement(\"div\", {\n    className: \"flex flex-col items-start mb-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"w-1/2 px-3 py-2 right-0 rounded-tr-lg rounded-bl-lg bg-orange-300\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 19\n    }\n  }, message.image === null ? /*#__PURE__*/React.createElement(React.Fragment, null) : /*#__PURE__*/React.createElement(\"img\", {\n    src: urlWeb + \"messages/\" + message.image,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 23\n    }\n  }), /*#__PURE__*/React.createElement(\"p\", {\n    className: \"text-gray-800\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 21\n    }\n  }, message.messages), /*#__PURE__*/React.createElement(\"p\", {\n    className: \"text-gray-700 font-bold text-sm\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(Moment, {\n    fromNow: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 23\n    }\n  }, message.created_at)))))), sendmessage.image != \"\" ? /*#__PURE__*/React.createElement(\"div\", {\n    className: \"flex flex-row items-center justify-center mt-2 rounded bg-gray-200 px-3 py-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    className: \"image-message\",\n    src: sendmessage.image,\n    alt: \"Image File\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    onClick: clearImage,\n    className: \"bg-red-600 hover:bg-red-900 text-white ml-2 font-bold px-4 py-3 rounded-full\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    class: \"fas fa-trash\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 19\n    }\n  })))) : /*#__PURE__*/React.createElement(React.Fragment, null), recordAudio ? /*#__PURE__*/React.createElement(ReactMic, {\n    record: recordAudio,\n    className: \"w-full rounded-full mt-3\",\n    onStop: onStopAudio,\n    onData: onDataAudio,\n    strokeColor: \"#cbd5e0\",\n    backgroundColor: \"#4a5568\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 13\n    }\n  }) : /*#__PURE__*/React.createElement(React.Fragment, null), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"flex mt-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 11\n    }\n  }, recordAudio ? /*#__PURE__*/React.createElement(\"button\", {\n    onClick: () => setRecordAudio(false),\n    className: \"bg-gray-700 hover:bg-gray-700 text-white font-bold px-4 py-3 mr-1 rounded-full\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 15\n    }\n  }, \"SEND\") : /*#__PURE__*/React.createElement(\"button\", {\n    onClick: () => setRecordAudio(true),\n    className: \"bg-gray-400 hover:bg-gray-700 text-white font-bold px-4 py-3 mr-1 rounded-full\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 231,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    class: \"fa fa-microphone\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(\"input\", {\n    id: \"text_message\",\n    name: \"messages\",\n    value: sendmessage.messages,\n    onChange: e => onChangeInput(e),\n    className: \"appearance-none w-full bg-gray-200 text-gray-700 border border-gray-200 rounded-full \\r mr-4 py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-gray-500\",\n    type: \"text\",\n    placeholder: \"Type message here....\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 239,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"file\",\n    name: \"image\",\n    onChange: e => getFileMessage(e),\n    id: \"fileImage\",\n    accept: \"image/*\",\n    className: \"hidden\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: getFile,\n    className: \"bg-green-400 hover:bg-green-700 text-white font-bold px-4 py-3 mr-1 rounded-full\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 258,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    className: \"fas fa-camera\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(\"button\", {\n    id: \"button_send_message\",\n    onClick: sendMessage,\n    className: \"bg-blue-400 hover:bg-blue-700 text-white font-bold px-4 py-3 rounded-full\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    className: \"fas fa-paper-plane\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 269,\n      columnNumber: 15\n    }\n  }))))));\n};\n\nexport default ChatRoom;","map":{"version":3,"sources":["D:/CODE/code/ReactJS/chatapp/src/pages/chatroom/index.jsx"],"names":["React","useEffect","useState","axios","Moment","useParams","ReactMic","urlApiMain","urlWeb","Auth","ChatRoom","id","recordAudio","setRecordAudio","messages","setMessages","sendmessage","setSetmessage","image","audio","receiver","onDataAudio","recordedBlob","onStopAudio","console","log","blob","fileReader","FileReader","readAsDataURL","onload","e","target","result","sendMessage","getChat","get","then","res","data","catch","err","onChangeInput","event","name","value","getFile","document","getElementById","click","getFileMessage","files","type","alert","clearChat","clearImage","readMessage","post","interval","setInterval","clearInterval","map","message","sender","getTokenAndUserId","userid","created_at","is_read"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport axios from \"axios\";\r\nimport Moment from \"react-moment\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport { ReactMic } from \"react-mic\";\r\nimport { urlApiMain, urlWeb } from \"../../utils/url\";\r\nimport { Auth } from \"../../config\";\r\n\r\nconst ChatRoom = () => {\r\n  const { id } = useParams();\r\n\r\n  const [recordAudio, setRecordAudio] = useState(false);\r\n\r\n  const [messages, setMessages] = useState([]);\r\n  const [sendmessage, setSetmessage] = useState({\r\n    messages: \"\",\r\n    image: \"\",\r\n    audio: \"\",\r\n    receiver: id,\r\n  });\r\n\r\n  const onDataAudio = (recordedBlob) => {};\r\n\r\n  const onStopAudio = (recordedBlob) => {\r\n    console.log(\"recordedBlob is: \", recordedBlob.blob);\r\n    var fileReader = new FileReader();\r\n    fileReader.readAsDataURL(recordedBlob.blob);\r\n    fileReader.onload = (e) => {\r\n      setSetmessage({\r\n        ...sendmessage,\r\n        [\"audio\"]: e.target.result,\r\n      });\r\n      sendMessage();\r\n    };\r\n  };\r\n\r\n  const getChat = () => {\r\n    axios\r\n      .get(`${urlApiMain}getchat/${id}`)\r\n      .then((res) => {\r\n        setMessages(res.data);\r\n      })\r\n      .catch((err) => {});\r\n  };\r\n\r\n  const onChangeInput = (event) => {\r\n    const { name, value } = event.target;\r\n    setSetmessage({\r\n      ...sendmessage,\r\n      [name]: value,\r\n    });\r\n  };\r\n\r\n  const getFile = () => {\r\n    document.getElementById(\"fileImage\").click();\r\n  };\r\n\r\n  const getFileMessage = (event) => {\r\n    var fileReader = new FileReader();\r\n    fileReader.readAsDataURL(event.target.files[0]);\r\n    const { type } = event.target.files[0];\r\n    console.log(event.target.files[0]);\r\n    if (type == \"image/png\" || type == \"image/jpeg\") {\r\n      fileReader.onload = (e) => {\r\n        setSetmessage({\r\n          ...sendmessage,\r\n          [\"image\"]: e.target.result,\r\n        });\r\n      };\r\n    } else {\r\n      alert(\"Image must has extention is png or jpeg.\");\r\n    }\r\n  };\r\n\r\n  const clearChat = () => {\r\n    setSetmessage({\r\n      ...sendmessage,\r\n      [\"messages\"]: \"\",\r\n      [\"image\"]: \"\",\r\n    });\r\n  };\r\n\r\n  const clearImage = () => {\r\n    setSetmessage({\r\n      ...sendmessage,\r\n      [\"image\"]: \"\",\r\n    });\r\n  };\r\n\r\n  const readMessage = () => {\r\n    axios\r\n      .get(`${urlApiMain}readmessage/${id}`)\r\n      .then((res) => {})\r\n      .then((err) => {\r\n        console.log(err);\r\n      });\r\n  };\r\n\r\n  const sendMessage = () => {\r\n    axios\r\n      .post(urlApiMain + \"sendchat\", sendmessage)\r\n      .then((res) => {\r\n        console.log(res);\r\n        getChat();\r\n        clearChat();\r\n      })\r\n      .catch((err) => {\r\n        console.log(err);\r\n      });\r\n  };\r\n\r\n  // set permission audio\r\n  useEffect(() => {\r\n    // navigator.getUserMedia(\r\n    //   { audio: true },\r\n    //   () => {\r\n    //     console.log(\"Permission Granted\");\r\n    //     setIsBlocked(false);\r\n    //   },\r\n    //   () => {\r\n    //     console.log(\"Permission Denied\");\r\n    //     setIsBlocked(true);\r\n    //   }\r\n    // );\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const interval = setInterval(() => {\r\n      readMessage();\r\n    }, 10000);\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const interval = setInterval(() => {\r\n      getChat();\r\n    }, 1000);\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"flex justify-center\">\r\n      <div className=\"bg-white md:w-1/2 mt-4 mb-6 rounded shadow-lg\">\r\n        <div className=\"px-6 py-6\">\r\n          <h2 className=\"font-semibold\">\r\n            {\" \"}\r\n            <i class=\"fas fa-arrow-left\"></i> Chat With By User\r\n          </h2>\r\n          <div className=\"bg-gray-200 message-height px-3 py-2 overflow-auto\">\r\n            {messages.map((message) =>\r\n              message.sender == Auth.getTokenAndUserId().userid ? (\r\n                <div className=\"flex flex-col items-end mb-3\">\r\n                  <div className=\"w-1/2 px-3 py-2 right-0 rounded-tl-lg rounded-br-lg bg-green-300\">\r\n                    {message.image === null ? (\r\n                      <></>\r\n                    ) : (\r\n                      <img src={urlWeb + \"messages/\" + message.image} />\r\n                    )}\r\n                    <p className=\"text-gray-800\">{message.messages}</p>\r\n                    <div className=\"flex flex-row w-full\">\r\n                      <p className=\"text-gray-700 font-bold text-sm\">\r\n                        <Moment fromNow>{message.created_at}</Moment>\r\n                      </p>\r\n                      {message.is_read == \"1\" ? (\r\n                        <i class=\"fas fa-check mt-1 ml-2 text-blue-500\"></i>\r\n                      ) : (\r\n                        <i class=\"fas fa-check mt-1 ml-2 text-gray-500\"></i>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ) : (\r\n                <div className=\"flex flex-col items-start mb-3\">\r\n                  <div className=\"w-1/2 px-3 py-2 right-0 rounded-tr-lg rounded-bl-lg bg-orange-300\">\r\n                    {message.image === null ? (\r\n                      <></>\r\n                    ) : (\r\n                      <img src={urlWeb + \"messages/\" + message.image} />\r\n                    )}\r\n                    <p className=\"text-gray-800\">{message.messages}</p>\r\n                    <p className=\"text-gray-700 font-bold text-sm\">\r\n                      <Moment fromNow>{message.created_at}</Moment>\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              )\r\n            )}\r\n          </div>\r\n          {sendmessage.image != \"\" ? (\r\n            <div className=\"flex flex-row items-center justify-center mt-2 rounded bg-gray-200 px-3 py-2\">\r\n              <div>\r\n                <img\r\n                  className=\"image-message\"\r\n                  src={sendmessage.image}\r\n                  alt=\"Image File\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <button\r\n                  onClick={clearImage}\r\n                  className=\"bg-red-600 hover:bg-red-900 text-white ml-2 font-bold px-4 py-3 rounded-full\"\r\n                >\r\n                  <i class=\"fas fa-trash\"></i>\r\n                </button>\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            <></>\r\n          )}\r\n          {recordAudio ? (\r\n            <ReactMic\r\n              record={recordAudio}\r\n              className=\"w-full rounded-full mt-3\"\r\n              onStop={onStopAudio}\r\n              onData={onDataAudio}\r\n              strokeColor=\"#cbd5e0\"\r\n              backgroundColor=\"#4a5568\"\r\n            />\r\n          ) : (\r\n            <></>\r\n          )}\r\n          <div className=\"flex mt-3\">\r\n            {recordAudio ? (\r\n              <button\r\n                onClick={() => setRecordAudio(false)}\r\n                className=\"bg-gray-700 hover:bg-gray-700 text-white font-bold px-4 py-3 mr-1 rounded-full\"\r\n              >\r\n                SEND\r\n              </button>\r\n            ) : (\r\n              <button\r\n                onClick={() => setRecordAudio(true)}\r\n                className=\"bg-gray-400 hover:bg-gray-700 text-white font-bold px-4 py-3 mr-1 rounded-full\"\r\n              >\r\n                <i class=\"fa fa-microphone\"></i>\r\n              </button>\r\n            )}\r\n\r\n            <input\r\n              id=\"text_message\"\r\n              name=\"messages\"\r\n              value={sendmessage.messages}\r\n              onChange={(e) => onChangeInput(e)}\r\n              className=\"appearance-none w-full bg-gray-200 text-gray-700 border border-gray-200 rounded-full \r\n              mr-4 py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-gray-500\"\r\n              type=\"text\"\r\n              placeholder=\"Type message here....\"\r\n            />\r\n            {/* <!-- Image Button Picker --> */}\r\n            <input\r\n              type=\"file\"\r\n              name=\"image\"\r\n              onChange={(e) => getFileMessage(e)}\r\n              id=\"fileImage\"\r\n              accept=\"image/*\"\r\n              className=\"hidden\"\r\n            />\r\n            <button\r\n              onClick={getFile}\r\n              className=\"bg-green-400 hover:bg-green-700 text-white font-bold px-4 py-3 mr-1 rounded-full\"\r\n            >\r\n              <i className=\"fas fa-camera\"></i>\r\n            </button>\r\n            <button\r\n              id=\"button_send_message\"\r\n              onClick={sendMessage}\r\n              className=\"bg-blue-400 hover:bg-blue-700 text-white font-bold px-4 py-3 rounded-full\"\r\n            >\r\n              <i className=\"fas fa-paper-plane\"></i>\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ChatRoom;\r\n"]},"metadata":{},"sourceType":"module"}